<div class="group-entity update" id="group<%= @group.id %>_entity<%= @entity_id %>" data-entity-id="<%= @entity_id %>">
	<%= form_for [:documents, @group], :url => "/documents/metadata_groups/entity", :method => :patch do |f| %>
		<input type="hidden" name="document_id" value="<%= @document.id %>" />
		<input type="hidden" name="group" value="<%= @group.name %>" />
		<input type="hidden" name="group_entity_id" value="<%= @entity_id %>" />
		<% @group.metadata_keys.order(:sort_order).each do |metadata_key| %>
			<div class="key-values" id="group<%= @group.id %>_entity<%= @entity_id %>_key<%= metadata_key.id %>">
				<div class="col-xs-12 col-lg-3">
					<label><%= metadata_key.name %></label>
				</div>
				<div class="col-xs-12 col-lg-9">
					<div class="values">
						<% metadatum_value = metadata_key.metadatum_values.for_entity(@entity_id).for_document(@document).first %>
						<% value_type = metadata_key.preferred_value_type %>
						<% if value_type.eql?("location")%>
							<%= render partial: "nested_metadata/documents/metadatum_values/locations/new_in_entity", locals: { document: @document, metadata_key: metadata_key, metadatum_value: metadatum_value } %>
						<% else %>
							<%= render partial: "nested_metadata/documents/metadatum_values/new_in_entity", locals: { document: @document, metadata_key: metadata_key, metadatum_value: metadatum_value } %>
						<% end %>
					</div>
				</div>
			</div>
		<% end %>
		<div class="controls">
			<%= link_to "Delete", "/documents/#{@document.id}/metadata_groups/#{@group.name}/entity/#{@entity_id}", :method => :delete, :class => "btn btn-danger" %>
			<%= button_tag "Update", class: "btn btn-success", onclick: "$(this).parent().submit();" %>
		</div>
	<% end %>
</div>
